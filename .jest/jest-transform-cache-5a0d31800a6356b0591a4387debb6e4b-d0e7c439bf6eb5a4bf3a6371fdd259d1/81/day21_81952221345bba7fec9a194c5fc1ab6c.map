{"version":3,"sources":["day21.js"],"names":["ops","addr","l","i1","i2","o","addi","mulr","muli","banr","bani","borr","bori","setr","seti","gtir","gtri","gtrr","eqir","eqri","eqrr","run","input","tap","cb","lines","split","ip","parseInt","shift","pop","commands","map","x","i","op","params","script","join","exec","vm","runInThisContext","part1","result","r","part2","prev","all","Set","has","add","undefined"],"mappings":"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","sourcesContent":["import vm from 'vm';\n\nconst ops = {\n  addr: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} + r${i2}; break;`,\n  addi: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} + ${i2}; break;`,\n  mulr: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} * r${i2}; break;`,\n  muli: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} * ${i2}; break;`,\n  banr: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} & r${i2}; break;`,\n  bani: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} & ${i2}; break;`,\n  borr: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} | r${i2}; break;`,\n  bori: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} | ${i2}; break;`,\n  setr: (l, i1, i2, o) => `case ${l}: r${o} = r${i1}; break;`,\n  seti: (l, i1, i2, o) => `case ${l}: r${o} = ${i1}; break;`,\n  gtir: (l, i1, i2, o) => `case ${l}: r${o} = ${i1} > r${i2} ? 1 : 0; break;`,\n  gtri: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} > ${i2} ? 1 : 0; break;`,\n  gtrr: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} > r${i2} ? 1 : 0; break;`,\n  eqir: (l, i1, i2, o) => `case ${l}: r${o} = ${i1} === r${i2} ? 1 : 0; break;`,\n  eqri: (l, i1, i2, o) => `case ${l}: r${o} = r${i1} === ${i2} ? 1 : 0; break;`,\n  eqrr: (l, i1, i2, o) => {\n    if (i1 === '0') {\n      return `case ${l}: r${o} = cb(r${i2}) === r${i2} ? 1 : 0; break;`;\n    } else if (i2 === '0') {\n      return `case ${l}: r${o} = r${i1} === cb(r${i1}) ? 1 : 0; break;`;\n    } else {\n      return `case ${l}: r${o} = r${i1} === r${i2} ? 1 : 0; break;`;\n    }\n  },\n};\n\nfunction run(input, tap, cb) {\n  const lines = input.split('\\n');\n  const ip = parseInt(\n    lines\n      .shift()\n      .split(' ')\n      .pop(),\n  );\n  const commands = lines.map((x, i) => {\n    const [op, ...params] = x.split(' ');\n    return ops[op](i, ...params);\n  });\n  const script = `(cb) => {\n    let r0 = 0, r1 = 0, r2 = 0, r3 = 0, r4 = 0, r5 = 0;\n    while (true) {\n      switch (r${ip}) {\n        ${commands.join('\\n')}\n        default: return null;\n      }\n      r${ip}++;\n    }\n  }`;\n  const exec = vm.runInThisContext(script);\n  return exec(tap, cb);\n}\n\nexport function part1(input) {\n  let result;\n  run(input, r => (result = r));\n  return result;\n}\n\nexport function part2(input) {\n  let prev;\n  const all = new Set();\n  run(input, r => (all.has(r) ? r : all.add((prev = r)) && undefined));\n  return prev;\n}\n"]}