03154ca732ebe6e7583fa8d4ef464cef
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.part1 = part1;
exports.part2 = part2;
const spells = {
  Missile: {
    mana: 53,
    effect: game => {
      return { ...game,
        boss: { ...game.boss,
          hit: game.boss.hit - 4
        }
      };
    },
    turns: 1
  },
  Drain: {
    mana: 73,
    effect: game => {
      return { ...game,
        boss: { ...game.boss,
          hit: game.boss.hit - 2
        },
        hero: { ...game.hero,
          hit: game.hero.hit + 2
        }
      };
    },
    turns: 1
  },
  Shield: {
    mana: 113,
    effect: game => {
      return { ...game,
        hero: { ...game.hero,
          armor: 7
        }
      };
    },
    turns: 6
  },
  Poison: {
    mana: 173,
    effect: game => {
      return { ...game,
        boss: { ...game.boss,
          hit: game.boss.hit - 3
        }
      };
    },
    turns: 6
  },
  Recharge: {
    mana: 229,
    effect: game => {
      return { ...game,
        hero: { ...game.hero,
          mana: game.hero.mana + 101
        }
      };
    },
    turns: 5
  }
};

function canSpell(spell, game) {
  return game.hero.mana >= spells[spell].mana && game.active[spell] === 0;
}

function runSpells(game) {
  game = { ...game,
    hero: { ...game.hero,
      armor: 0
    }
  };

  for (const spell in game.active) {
    if (game.active[spell] > 0) {
      game = spells[spell].effect(game);
      game = { ...game,
        active: { ...game.active,
          [spell]: game.active[spell] - 1
        }
      };
    }
  }

  return game;
}

function castSpell(spell, game) {
  return { ...game,
    hero: { ...game.hero,
      mana: game.hero.mana - spells[spell].mana
    },
    active: { ...game.active,
      [spell]: spells[spell].turns
    }
  };
}

function playBoss(game) {
  return { ...game,
    hero: { ...game.hero,
      hit: game.hero.hit - Math.max(1, game.boss.damage - game.hero.armor)
    }
  };
}

function memoize(fn) {
  const memo = {};
  return function (x) {
    const s = JSON.stringify(x);

    if (!memo[s]) {
      memo[s] = fn(x);
    }

    return memo[s];
  };
}

const play = memoize(game => {
  if (game.boss.hit <= 0) {
    return 0;
  } else if (game.hero.hit <= 0) {
    return Infinity;
  }

  let min = Infinity;
  game = runSpells(game);

  for (const spell in spells) {
    if (canSpell(spell, game)) {
      let move = castSpell(spell, game);
      move = runSpells(move);
      move = playBoss(move);
      min = Math.min(spells[spell].mana + play(move), min);
    }
  }

  return min;
});

function parse(input, initialHit, initialMana) {
  const [hit, damage] = input.match(/\d+/g);
  const hero = {
    hit: initialHit,
    mana: initialMana,
    armor: 0
  };
  const boss = {
    hit: parseInt(hit),
    damage: parseInt(damage),
    armor: 0
  };
  const active = Object.keys(spells).reduce((obj, spell) => ({ ...obj,
    [spell]: 0
  }), {});
  return {
    hero,
    boss,
    active
  };
}

function part1(input, initialHit = 50, initialMana = 500) {
  return play(parse(input, initialHit, initialMana));
}

function part2(input, initialHit = 50, initialMana = 500) {
  const state = parse(input, initialHit, initialMana);
  state.hero.hit--;
  state.boss.damage++;
  return play(state);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRheTIyLmpzIl0sIm5hbWVzIjpbInNwZWxscyIsIk1pc3NpbGUiLCJtYW5hIiwiZWZmZWN0IiwiZ2FtZSIsImJvc3MiLCJoaXQiLCJ0dXJucyIsIkRyYWluIiwiaGVybyIsIlNoaWVsZCIsImFybW9yIiwiUG9pc29uIiwiUmVjaGFyZ2UiLCJjYW5TcGVsbCIsInNwZWxsIiwiYWN0aXZlIiwicnVuU3BlbGxzIiwiY2FzdFNwZWxsIiwicGxheUJvc3MiLCJNYXRoIiwibWF4IiwiZGFtYWdlIiwibWVtb2l6ZSIsImZuIiwibWVtbyIsIngiLCJzIiwiSlNPTiIsInN0cmluZ2lmeSIsInBsYXkiLCJJbmZpbml0eSIsIm1pbiIsIm1vdmUiLCJwYXJzZSIsImlucHV0IiwiaW5pdGlhbEhpdCIsImluaXRpYWxNYW5hIiwibWF0Y2giLCJwYXJzZUludCIsIk9iamVjdCIsImtleXMiLCJyZWR1Y2UiLCJvYmoiLCJwYXJ0MSIsInBhcnQyIiwic3RhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxNQUFNQSxNQUFNLEdBQUc7QUFDYkMsRUFBQUEsT0FBTyxFQUFFO0FBQ1BDLElBQUFBLElBQUksRUFBRSxFQURDO0FBRVBDLElBQUFBLE1BQU0sRUFBRUMsSUFBSSxJQUFJO0FBQ2QsYUFBTyxFQUFFLEdBQUdBLElBQUw7QUFBV0MsUUFBQUEsSUFBSSxFQUFFLEVBQUUsR0FBR0QsSUFBSSxDQUFDQyxJQUFWO0FBQWdCQyxVQUFBQSxHQUFHLEVBQUVGLElBQUksQ0FBQ0MsSUFBTCxDQUFVQyxHQUFWLEdBQWdCO0FBQXJDO0FBQWpCLE9BQVA7QUFDRCxLQUpNO0FBS1BDLElBQUFBLEtBQUssRUFBRTtBQUxBLEdBREk7QUFRYkMsRUFBQUEsS0FBSyxFQUFFO0FBQ0xOLElBQUFBLElBQUksRUFBRSxFQUREO0FBRUxDLElBQUFBLE1BQU0sRUFBRUMsSUFBSSxJQUFJO0FBQ2QsYUFBTyxFQUNMLEdBQUdBLElBREU7QUFFTEMsUUFBQUEsSUFBSSxFQUFFLEVBQUUsR0FBR0QsSUFB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ICAgbWFuYTogNTMsXG4gICAgZWZmZWN0OiBnYW1lID0+IHtcbiAgICAgIHJldHVybiB7IC4uLmdhbWUsIGJvc3M6IHsgLi4uZ2FtZS5ib3NzLCBoaXQ6IGdhbWUuYm9zcy5oaXQgLSA0IH0gfTtcbiAgICB9LFxuICAgIHR1cm5zOiAxLFxuICB9LFxuICBEcmFpbjoge1xuICAgIG1hbmE6IDczLFxuICAgIGVmZmVjdDogZ2FtZSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5nYW1lLFxuICAgICAgICBib3NzOiB7IC4uLmdhbWUuYm9zcywgaGl0OiBnYW1lLmJvc3MuaGl0IC0gMiB9LFxuICAgICAgICBoZXJvOiB7IC4uLmdhbWUuaGVybywgaGl0OiBnYW1lLmhlcm8uaGl0ICsgMiB9LFxuICAgICAgfTtcbiAgICB9LFxuICAgIHR1cm5zOiAxLFxuICB9LFxuICBTaGllbGQ6IHtcbiAgICBtYW5hOiAxMTMsXG4gICAgZWZmZWN0OiBnYW1lID0+IHtcbiAgICAgIHJldHVybiB7IC4uLmdhbWUsIGhlcm86IHsgLi4uZ2FtZS5oZXJvLCBhcm1vcjogNyB9IH07XG4gICAgfSxcbiAgICB0dXJuczogNixcbiAgfSxcbiAgUG9pc29uOiB7XG4gICAgbWFuYTogMTczLFxuICAgIGVmZmVjdDogZ2FtZSA9PiB7XG4gICAgICByZXR1cm4geyAuLi5nYW1lLCBib3NzOiB7IC4uLmdhbWUuYm9zcywgaGl0OiBnYW1lLmJvc3MuaGl0IC0gMyB9IH07XG4gICAgfSxcbiAgICB0dXJuczogNixcbiAgfSxcbiAgUmVjaGFyZ2U6IHtcbiAgICBtYW5hOiAyMjksXG4gICAgZWZmZWN0OiBnYW1lID0+IHtcbiAgICAgIHJldHVybiB7IC4uLmdhbWUsIGhlcm86IHsgLi4uZ2FtZS5oZXJvLCBtYW5hOiBnYW1lLmhlcm8ubWFuYSArIDEwMSB9IH07XG4gICAgfSxcbiAgICB0dXJuczogNSxcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIGNhblNwZWxsKHNwZWxsLCBnYW1lKSB7XG4gIHJldHVybiBnYW1lLmhlcm8ubWFuYSA+PSBzcGVsbHNbc3BlbGxdLm1hbmEgJiYgZ2FtZS5hY3RpdmVbc3BlbGxdID09PSAwO1xufVxuXG5mdW5jdGlvbiBydW5TcGVsbHMoZ2FtZSkge1xuICBnYW1lID0geyAuLi5nYW1lLCBoZXJvOiB7IC4uLmdhbWUuaGVybywgYXJtb3I6IDAgfSB9O1xuICBmb3IgKGNvbnN0IHNwZWxsIGluIGdhbWUuYWN0aXZlKSB7XG4gICAgaWYgKGdhbWUuYWN0aXZlW3NwZWxsXSA+IDApIHtcbiAgICAgIGdhbWUgPSBzcGVsbHNbc3BlbGxdLmVmZmVjdChnYW1lKTtcbiAgICAgIGdhbWUgPSB7XG4gICAgICAgIC4uLmdhbWUsXG4gICAgICAgIGFjdGl2ZTogeyAuLi5nYW1lLmFjdGl2ZSwgW3NwZWxsXTogZ2FtZS5hY3RpdmVbc3BlbGxdIC0gMSB9LFxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGdhbWU7XG59XG5cbmZ1bmN0aW9uIGNhc3RTcGVsbChzcGVsbCwgZ2FtZSkge1xuICByZXR1cm4ge1xuICAgIC4uLmdhbWUsXG4gICAgaGVybzogeyAuLi5nYW1lLmhlcm8sIG1hbmE6IGdhbWUuaGVyby5tYW5hIC0gc3BlbGxzW3NwZWxsXS5tYW5hIH0sXG4gICAgYWN0aXZlOiB7IC4uLmdhbWUuYWN0aXZlLCBbc3BlbGxdOiBzcGVsbHNbc3BlbGxdLnR1cm5zIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIHBsYXlCb3NzKGdhbWUpIHtcbiAgcmV0dXJuIHtcbiAgICAuLi5nYW1lLFxuICAgIGhlcm86IHtcbiAgICAgIC4uLmdhbWUuaGVybyxcbiAgICAgIGhpdDogZ2FtZS5oZXJvLmhpdCAtIE1hdGgubWF4KDEsIGdhbWUuYm9zcy5kYW1hZ2UgLSBnYW1lLmhlcm8uYXJtb3IpLFxuICAgIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIG1lbW9pemUoZm4pIHtcbiAgY29uc3QgbWVtbyA9IHt9O1xuICByZXR1cm4gZnVuY3Rpb24oeCkge1xuICAgIGNvbnN0IHMgPSBKU09OLnN0cmluZ2lmeSh4KTtcbiAgICBpZiAoIW1lbW9bc10pIHtcbiAgICAgIG1lbW9bc10gPSBmbih4KTtcbiAgICB9XG4gICAgcmV0dXJuIG1lbW9bc107XG4gIH07XG59XG5cbmNvbnN0IHBsYXkgPSBtZW1vaXplKGdhbWUgPT4ge1xuICBpZiAoZ2FtZS5ib3NzLmhpdCA8PSAwKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSBpZiAoZ2FtZS5oZXJvLmhpdCA8PSAwKSB7XG4gICAgcmV0dXJuIEluZmluaXR5O1xuICB9XG4gIGxldCBtaW4gPSBJbmZpbml0eTtcbiAgZ2FtZSA9IHJ1blNwZWxscyhnYW1lKTtcbiAgZm9yIChjb25zdCBzcGVsbCBpbiBzcGVsbHMpIHtcbiAgICBpZiAoY2FuU3BlbGwoc3BlbGwsIGdhbWUpKSB7XG4gICAgICBsZXQgbW92ZSA9IGNhc3RTcGVsbChzcGVsbCwgZ2FtZSk7XG4gICAgICBtb3ZlID0gcnVuU3BlbGxzKG1vdmUpO1xuICAgICAgbW92ZSA9IHBsYXlCb3NzKG1vdmUpO1xuICAgICAgbWluID0gTWF0aC5taW4oc3BlbGxzW3NwZWxsXS5tYW5hICsgcGxheShtb3ZlKSwgbWluKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1pbjtcbn0pO1xuXG5mdW5jdGlvbiBwYXJzZShpbnB1dCwgaW5pdGlhbEhpdCwgaW5pdGlhbE1hbmEpIHtcbiAgY29uc3QgW2hpdCwgZGFtYWdlXSA9IGlucHV0Lm1hdGNoKC9cXGQrL2cpO1xuICBjb25zdCBoZXJvID0geyBoaXQ6IGluaXRpYWxIaXQsIG1hbmE6IGluaXRpYWxNYW5hLCBhcm1vcjogMCB9O1xuICBjb25zdCBib3NzID0ge1xuICAgIGhpdDogcGFyc2VJbnQoaGl0KSxcbiAgICBkYW1hZ2U6IHBhcnNlSW50KGRhbWFnZSksXG4gICAgYXJtb3I6IDAsXG4gIH07XG4gIGNvbnN0IGFjdGl2ZSA9IE9iamVjdC5rZXlzKHNwZWxscykucmVkdWNlKFxuICAgIChvYmosIHNwZWxsKSA9PiAoeyAuLi5vYmosIFtzcGVsbF06IDAgfSksXG4gICAge30sXG4gICk7XG4gIHJldHVybiB7IGhlcm8sIGJvc3MsIGFjdGl2ZSB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFydDEoaW5wdXQsIGluaXRpYWxIaXQgPSA1MCwgaW5pdGlhbE1hbmEgPSA1MDApIHtcbiAgcmV0dXJuIHBsYXkocGFyc2UoaW5wdXQsIGluaXRpYWxIaXQsIGluaXRpYWxNYW5hKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJ0MihpbnB1dCwgaW5pdGlhbEhpdCA9IDUwLCBpbml0aWFsTWFuYSA9IDUwMCkge1xuICBjb25zdCBzdGF0ZSA9IHBhcnNlKGlucHV0LCBpbml0aWFsSGl0LCBpbml0aWFsTWFuYSk7XG4gIHN0YXRlLmhlcm8uaGl0LS07XG4gIHN0YXRlLmJvc3MuZGFtYWdlKys7XG4gIHJldHVybiBwbGF5KHN0YXRlKTtcbn1cbiJdfQ==