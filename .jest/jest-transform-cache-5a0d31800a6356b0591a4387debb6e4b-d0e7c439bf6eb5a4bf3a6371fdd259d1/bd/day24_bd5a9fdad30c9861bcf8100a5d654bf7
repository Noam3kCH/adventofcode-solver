20742f36ffe67764e5413f9e9288c748
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.part2 = exports.part1 = void 0;

var _jsCombinatorics = _interopRequireDefault(require("js-combinatorics"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function parse(input) {
  const targets = [];
  const maze = input.split('\n').map((line, y) => line.split('').map((c, x) => {
    if (c === '#') {
      return {
        x,
        y,
        wall: true
      };
    } else if (c === '.') {
      return {
        x,
        y,
        wall: false
      };
    } else {
      const point = {
        x,
        y,
        wall: false,
        target: parseInt(c)
      };
      targets.push(point);
      return point;
    }
  }));
  return {
    maze,
    targets
  };
}

function getNeighbors(maze, point, props) {
  const {
    x,
    y
  } = point;
  return [{ ...props,
    point: maze[y][x - 1]
  }, { ...props,
    point: maze[y][x + 1]
  }, { ...props,
    point: maze[y - 1][x]
  }, { ...props,
    point: maze[y + 1][x]
  }].filter(x => !x.point.wall);
}

function path(maze, source, destination) {
  const visited = new Set().add(source);
  let queue = [{
    distance: 0,
    point: source
  }];

  while (queue.length) {
    const {
      distance,
      point
    } = queue.shift();
    const neighbors = getNeighbors(maze, point, {
      distance: distance + 1
    }).filter(({
      point
    }) => !visited.has(point));
    neighbors.forEach(({
      point
    }) => visited.add(point));

    if (visited.has(destination)) {
      return distance + 1;
    }

    queue = queue.concat(neighbors);
  }
}

function solve({
  maze,
  targets
}, andBack) {
  const back = {};

  const paths = _jsCombinatorics.default.combination(targets, 2).toArray().map(([source, destination]) => {
    const distance = path(maze, source, destination);

    if (source.target === 0 || destination.target === 0) {
      back[source.target + destination.target] = distance;
    }

    return {
      points: [source.target, destination.target],
      distance
    };
  });

  const options = _jsCombinatorics.default.combination(paths, targets.length - 1).map(option => {
    const points = option.reduce((points, path) => {
      points[path.points[0]] = (points[path.points[0]] || []).concat([path.points[1]]);
      points[path.points[1]] = (points[path.points[1]] || []).concat([path.points[0]]);
      return points;
    }, {});
    const state = {
      current: 0,
      visited: new Set().add(0)
    };

    while (points[state.current] && points[state.current].length === 1) {
      const prev = state.current;
      state.current = points[state.current].shift();
      points[state.current] = points[state.current].filter(x => x !== prev);
      state.visited.add(state.current);
    }

    return state.visited.size === targets.length && {
      length: option.reduce((distance, path) => distance + path.distance, 0),
      back: back[state.current]
    };
  }).filter(x => x);

  return options.reduce((shortest, option) => {
    return Math.min(shortest, andBack ? option.length + option.back : option.length);
  }, Infinity);
}

const part1 = input => solve(parse(input), false);

exports.part1 = part1;

const part2 = input => solve(parse(input), true);

exports.part2 = part2;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRheTI0LmpzIl0sIm5hbWVzIjpbInBhcnNlIiwiaW5wdXQiLCJ0YXJnZXRzIiwibWF6ZSIsInNwbGl0IiwibWFwIiwibGluZSIsInkiLCJjIiwieCIsIndhbGwiLCJwb2ludCIsInRhcmdldCIsInBhcnNlSW50IiwicHVzaCIsImdldE5laWdoYm9ycyIsInByb3BzIiwiZmlsdGVyIiwicGF0aCIsInNvdXJjZSIsImRlc3RpbmF0aW9uIiwidmlzaXRlZCIsIlNldCIsImFkZCIsInF1ZXVlIiwiZGlzdGFuY2UiLCJsZW5ndGgiLCJzaGlmdCIsIm5laWdoYm9ycyIsImhhcyIsImZvckVhY2giLCJjb25jYXQiLCJzb2x2ZSIsImFuZEJhY2siLCJiYWNrIiwicGF0aHMiLCJDb21iaW5hdG9yaWNzIiwiY29tYmluYXRpb24iLCJ0b0FycmF5IiwicG9pbnRzIiwib3B0aW9ucyIsIm9wdGlvbiIsInJlZHVjZSIsInN0YXRlIiwiY3VycmVudCIsInByZXYiLCJzaXplIiwic2hvcnRlc3QiLCJNYXRoIiwibWluIiwiSW5maW5pdHkiLCJwYXJ0MSIsInBhcnQyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQSxTQUFTQSxLQUFULENBQWVDLEtBQWYsRUFBc0I7QUFDcEIsUUFBTUMsT0FBTyxHQUFHLEVBQWhCO0FBQ0EsUUFBTUMsSUFBSSxHQUFHRixLQUFLLENBQUNHLEtBQU4sQ0FBWSxJQUFaLEVBQWtCQyxHQUFsQixDQUFzQixDQUFDQyxJQUFELEVBQU9DLENBQVAsS0FDakNELElBQUksQ0FBQ0YsS0FBTCxDQUFXLEVBQVgsRUFBZUMsR0FBZixDQUFtQixDQUFDRyxDQUFELEVBQUlDLENBQUosS0FBVTtBQUMzQixRQUFJRCxDQUFDLEtBQUssR0FBVixFQUFlO0FBQ2IsYUFBTztBQUFFQyxRQUFBQSxDQUFGO0FBQUtGLFFBQUFBLENBQUw7QUFBUUcsUUFBQUEsSUFBSSxFQUFFO0FBQWQsT0FBUDtBQUNELEtBRkQsTUFFTyxJQUFJRixDQUFDLEtBQUssR0FB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O0FBQ3ZDQSxNQUFBQSxNQUFNLEVBQUVlLE1BQU0sQ0FBQ0MsTUFBUCxDQUNOLENBQUNqQixRQUFELEVBQVdQLElBQVgsS0FBb0JPLFFBQVEsR0FBR1AsSUFBSSxDQUFDTyxRQUQ5QixFQUVOLENBRk0sQ0FEK0I7QUFLdkNTLE1BQUFBLElBQUksRUFBRUEsSUFBSSxDQUFDUyxLQUFLLENBQUNDLE9BQVA7QUFMNkIsS0FEM0M7QUFTRCxHQTNCYSxFQTRCYjNCLE1BNUJhLENBNEJOUixDQUFDLElBQUlBLENBNUJDLENBQWhCOztBQThCQSxTQUFPK0IsT0FBTyxDQUFDRSxNQUFSLENBQWUsQ0FBQ0ssUUFBRCxFQUFXTixNQUFYLEtBQXNCO0FBQzFDLFdBQU9PLElBQUksQ0FBQ0MsR0FBTCxDQUNMRixRQURLLEVBRUxkLE9BQU8sR0FBR1EsTUFBTSxDQUFDZixNQUFQLEdBQWdCZSxNQUFNLENBQUNQLElBQTFCLEdBQWlDTyxNQUFNLENBQUNmLE1BRjFDLENBQVA7QUFJRCxHQUxNLEVBS0p3QixRQUxJLENBQVA7QUFNRDs7QUFFTSxNQUFNQyxLQUFLLEdBQUdsRCxLQUFLLElBQUkrQixLQUFLLENBQUNoQyxLQUFLLENBQUNDLEtBQUQsQ0FBTixFQUFlLEtBQWYsQ0FBNUI7Ozs7QUFDQSxNQUFNbUQsS0FBSyxHQUFHbkQsS0FBSyxJQUFJK0IsS0FBSyxDQUFDaEMsS0FBSyxDQUFDQyxLQUFELENBQU4sRUFBZSxJQUFmLENBQTVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbWJpbmF0b3JpY3MgZnJvbSAnanMtY29tYmluYXRvcmljcyc7XG5cbmZ1bmN0aW9uIHBhcnNlKGlucHV0KSB7XG4gIGNvbnN0IHRhcmdldHMgPSBbXTtcbiAgY29uc3QgbWF6ZSA9IGlucHV0LnNwbGl0KCdcXG4nKS5tYXAoKGxpbmUsIHkpID0+XG4gICAgbGluZS5zcGxpdCgnJykubWFwKChjLCB4KSA9PiB7XG4gICAgICBpZiAoYyA9PT0gJyMnKSB7XG4gICAgICAgIHJldHVybiB7IHgsIHksIHdhbGw6IHRydWUgfTtcbiAgICAgIH0gZWxzZSBpZiAoYyA9PT0gJy4nKSB7XG4gICAgICAgIHJldHVybiB7IHgsIHksIHdhbGw6IGZhbHNlIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBwb2ludCA9IHsgeCwgeSwgd2FsbDogZmFsc2UsIHRhcmdldDogcGFyc2VJbnQoYykgfTtcbiAgICAgICAgdGFyZ2V0cy5wdXNoKHBvaW50KTtcbiAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgfVxuICAgIH0pLFxuICApO1xuICByZXR1cm4geyBtYXplLCB0YXJnZXRzIH07XG59XG5cbmZ1bmN0aW9uIGdldE5laWdoYm9ycyhtYXplLCBwb2ludCwgcHJvcHMpIHtcbiAgY29uc3QgeyB4LCB5IH0gPSBwb2ludDtcbiAgcmV0dXJuIFtcbiAgICB7IC4uLnByb3BzLCBwb2ludDogbWF6ZVt5XVt4IC0gMV0gfSxcbiAgICB7IC4uLnByb3BzLCBwb2ludDogbWF6ZVt5XVt4ICsgMV0gfSxcbiAgICB7IC4uLnByb3BzLCBwb2ludDogbWF6ZVt5IC0gMV1beF0gfSxcbiAgICB7IC4uLnByb3BzLCBwb2ludDogbWF6ZVt5ICsgMV1beF0gfSxcbiAgXS5maWx0ZXIoeCA9PiAheC5wb2ludC53YWxsKTtcbn1cblxuZnVuY3Rpb24gcGF0aChtYXplLCBzb3VyY2UsIGRlc3RpbmF0aW9uKSB7XG4gIGNvbnN0IHZpc2l0ZWQgPSBuZXcgU2V0KCkuYWRkKHNvdXJjZSk7XG4gIGxldCBxdWV1ZSA9IFt7IGRpc3RhbmNlOiAwLCBwb2ludDogc291cmNlIH1dO1xuICB3aGlsZSAocXVldWUubGVuZ3RoKSB7XG4gICAgY29uc3QgeyBkaXN0YW5jZSwgcG9pbnQgfSA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgY29uc3QgbmVpZ2hib3JzID0gZ2V0TmVpZ2hib3JzKG1hemUsIHBvaW50LCB7XG4gICAgICBkaXN0YW5jZTogZGlzdGFuY2UgKyAxLFxuICAgIH0pLmZpbHRlcigoeyBwb2ludCB9KSA9PiAhdmlzaXRlZC5oYXMocG9pbnQpKTtcbiAgICBuZWlnaGJvcnMuZm9yRWFjaCgoeyBwb2ludCB9KSA9PiB2aXNpdGVkLmFkZChwb2ludCkpO1xuICAgIGlmICh2aXNpdGVkLmhhcyhkZXN0aW5hdGlvbikpIHtcbiAgICAgIHJldHVybiBkaXN0YW5jZSArIDE7XG4gICAgfVxuICAgIHF1ZXVlID0gcXVldWUuY29uY2F0KG5laWdoYm9ycyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc29sdmUoeyBtYXplLCB0YXJnZXRzIH0sIGFuZEJhY2spIHtcbiAgY29uc3QgYmFjayA9IHt9O1xuICBjb25zdCBwYXRocyA9IENvbWJpbmF0b3JpY3MuY29tYmluYXRpb24odGFyZ2V0cywgMilcbiAgICAudG9BcnJheSgpXG4gICAgLm1hcCgoW3NvdXJjZSwgZGVzdGluYXRpb25dKSA9PiB7XG4gICAgICBjb25zdCBkaXN0YW5jZSA9IHBhdGgobWF6ZSwgc291cmNlLCBkZXN0aW5hdGlvbik7XG4gICAgICBpZiAoc291cmNlLnRhcmdldCA9PT0gMCB8fCBkZXN0aW5hdGlvbi50YXJnZXQgPT09IDApIHtcbiAgICAgICAgYmFja1tzb3VyY2UudGFyZ2V0ICsgZGVzdGluYXRpb24udGFyZ2V0XSA9IGRpc3RhbmNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgcG9pbnRzOiBbc291cmNlLnRhcmdldCwgZGVzdGluYXRpb24udGFyZ2V0XSwgZGlzdGFuY2UgfTtcbiAgICB9KTtcblxuICBjb25zdCBvcHRpb25zID0gQ29tYmluYXRvcmljcy5jb21iaW5hdGlvbihwYXRocywgdGFyZ2V0cy5sZW5ndGggLSAxKVxuICAgIC5tYXAob3B0aW9uID0+IHtcbiAgICAgIGNvbnN0IHBvaW50cyA9IG9wdGlvbi5yZWR1Y2UoKHBvaW50cywgcGF0aCkgPT4ge1xuICAgICAgICBwb2ludHNbcGF0aC5wb2ludHNbMF1dID0gKHBvaW50c1twYXRoLnBvaW50c1swXV0gfHwgW10pLmNvbmNhdChbXG4gICAgICAgICAgcGF0aC5wb2ludHNbMV0sXG4gICAgICAgIF0pO1xuICAgICAgICBwb2ludHNbcGF0aC5wb2ludHNbMV1dID0gKHBvaW50c1twYXRoLnBvaW50c1sxXV0gfHwgW10pLmNvbmNhdChbXG4gICAgICAgICAgcGF0aC5wb2ludHNbMF0sXG4gICAgICAgIF0pO1xuICAgICAgICByZXR1cm4gcG9pbnRzO1xuICAgICAgfSwge30pO1xuICAgICAgY29uc3Qgc3RhdGUgPSB7IGN1cnJlbnQ6IDAsIHZpc2l0ZWQ6IG5ldyBTZXQoKS5hZGQoMCkgfTtcbiAgICAgIHdoaWxlIChwb2ludHNbc3RhdGUuY3VycmVudF0gJiYgcG9pbnRzW3N0YXRlLmN1cnJlbnRdLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBjb25zdCBwcmV2ID0gc3RhdGUuY3VycmVudDtcbiAgICAgICAgc3RhdGUuY3VycmVudCA9IHBvaW50c1tzdGF0ZS5jdXJyZW50XS5zaGlmdCgpO1xuICAgICAgICBwb2ludHNbc3RhdGUuY3VycmVudF0gPSBwb2ludHNbc3RhdGUuY3VycmVudF0uZmlsdGVyKHggPT4geCAhPT0gcHJldik7XG4gICAgICAgIHN0YXRlLnZpc2l0ZWQuYWRkKHN0YXRlLmN1cnJlbnQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgc3RhdGUudmlzaXRlZC5zaXplID09PSB0YXJnZXRzLmxlbmd0aCAmJiB7XG4gICAgICAgICAgbGVuZ3RoOiBvcHRpb24ucmVkdWNlKFxuICAgICAgICAgICAgKGRpc3RhbmNlLCBwYXRoKSA9PiBkaXN0YW5jZSArIHBhdGguZGlzdGFuY2UsXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICksXG4gICAgICAgICAgYmFjazogYmFja1tzdGF0ZS5jdXJyZW50XSxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KVxuICAgIC5maWx0ZXIoeCA9PiB4KTtcblxuICByZXR1cm4gb3B0aW9ucy5yZWR1Y2UoKHNob3J0ZXN0LCBvcHRpb24pID0+IHtcbiAgICByZXR1cm4gTWF0aC5taW4oXG4gICAgICBzaG9ydGVzdCxcbiAgICAgIGFuZEJhY2sgPyBvcHRpb24ubGVuZ3RoICsgb3B0aW9uLmJhY2sgOiBvcHRpb24ubGVuZ3RoLFxuICAgICk7XG4gIH0sIEluZmluaXR5KTtcbn1cblxuZXhwb3J0IGNvbnN0IHBhcnQxID0gaW5wdXQgPT4gc29sdmUocGFyc2UoaW5wdXQpLCBmYWxzZSk7XG5leHBvcnQgY29uc3QgcGFydDIgPSBpbnB1dCA9PiBzb2x2ZShwYXJzZShpbnB1dCksIHRydWUpO1xuIl19