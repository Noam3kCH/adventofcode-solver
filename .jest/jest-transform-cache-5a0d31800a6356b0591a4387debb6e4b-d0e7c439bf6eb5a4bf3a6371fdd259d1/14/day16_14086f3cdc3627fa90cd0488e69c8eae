e09437a3a43c7a33d0bd8c1ed9b98db5
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.part1 = part1;
exports.part2 = part2;
const ops = {
  addr: (r, i1, i2, o) => r[o] = r[i1] + r[i2],
  addi: (r, i1, i2, o) => r[o] = r[i1] + i2,
  mulr: (r, i1, i2, o) => r[o] = r[i1] * r[i2],
  muli: (r, i1, i2, o) => r[o] = r[i1] * i2,
  banr: (r, i1, i2, o) => r[o] = r[i1] & r[i2],
  bani: (r, i1, i2, o) => r[o] = r[i1] & i2,
  borr: (r, i1, i2, o) => r[o] = r[i1] | r[i2],
  bori: (r, i1, i2, o) => r[o] = r[i1] | i2,
  setr: (r, i1, i2, o) => r[o] = r[i1],
  seti: (r, i1, i2, o) => r[o] = i1,
  gtir: (r, i1, i2, o) => r[o] = i1 > r[i2] ? 1 : 0,
  gtri: (r, i1, i2, o) => r[o] = r[i1] > i2 ? 1 : 0,
  gtrr: (r, i1, i2, o) => r[o] = r[i1] > r[i2] ? 1 : 0,
  eqir: (r, i1, i2, o) => r[o] = i1 === r[i2] ? 1 : 0,
  eqri: (r, i1, i2, o) => r[o] = r[i1] === i2 ? 1 : 0,
  eqrr: (r, i1, i2, o) => r[o] = r[i1] === r[i2] ? 1 : 0
};

const numbers = arr => arr.map(x => parseInt(x));

function parseSamples(input) {
  const samples = input.split('\n\n\n\n')[0].split('\n\n');
  return samples.map(sample => {
    const [before, instruction, after] = sample.split('\n');
    const regex = /\[(\d+), (\d+), (\d+), (\d+)\]/;
    const [, r1, r2, r3, r4] = numbers(before.match(regex));
    const [, o1, o2, o3, o4] = numbers(after.match(regex));
    const [op, ...params] = numbers(instruction.split(' '));
    const options = Object.keys(ops).filter(op => {
      const r = [r1, r2, r3, r4];
      const o = [o1, o2, o3, o4];
      ops[op](r, ...params);
      return r.join(',') === o.join(',');
    });
    return {
      op,
      options
    };
  });
}

function part1(input) {
  return parseSamples(input).filter(s => s.options.length >= 3).length;
}

function part2(input) {
  const result = parseSamples(input);
  let dic = new Array(Object.keys(ops).length).fill();
  dic = dic.map(() => Object.keys(ops));
  result.forEach(({
    op,
    options
  }) => {
    dic[op] = dic[op].filter(x => options.includes(x));
  });

  while (dic.some(x => x.length > 1)) {
    const done = dic.filter(x => x.length === 1).map(x => x[0]);
    dic = dic.map(x => x.length > 1 ? x.filter(op => !done.includes(op)) : x);
  }

  const program = input.split('\n\n\n\n').pop();
  const commands = program.split('\n').map(x => numbers(x.split(' ')));
  const r = [0, 0, 0, 0];
  commands.forEach(([op, ...params]) => ops[dic[op][0]](r, ...params));
  return r[0];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRheTE2LmpzIl0sIm5hbWVzIjpbIm9wcyIsImFkZHIiLCJyIiwiaTEiLCJpMiIsIm8iLCJhZGRpIiwibXVsciIsIm11bGkiLCJiYW5yIiwiYmFuaSIsImJvcnIiLCJib3JpIiwic2V0ciIsInNldGkiLCJndGlyIiwiZ3RyaSIsImd0cnIiLCJlcWlyIiwiZXFyaSIsImVxcnIiLCJudW1iZXJzIiwiYXJyIiwibWFwIiwieCIsInBhcnNlSW50IiwicGFyc2VTYW1wbGVzIiwiaW5wdXQiLCJzYW1wbGVzIiwic3BsaXQiLCJzYW1wbGUiLCJiZWZvcmUiLCJpbnN0cnVjdGlvbiIsImFmdGVyIiwicmVnZXgiLCJyMSIsInIyIiwicjMiLCJyNCIsIm1hdGNoIiwibzEiLCJvMiIsIm8zIiwibzQiLCJvcCIsInBhcmFtcyIsIm9wdGlvbnMiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwiam9pbiIsInBhcnQxIiwicyIsImxlbmd0aCIsInBhcnQyIiwicmVzdWx0IiwiZGljIiwiQXJyYXkiLCJmaWxsIiwiZm9yRWFjaCIsImluY2x1ZGVzIiwic29tZSIsImRvbmUiLCJwcm9ncmFtIiwicG9wIiwiY29tbWFuZHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxNQUFNQSxHQUFHLEdBQUc7QUFDVkMsRUFBQUEsSUFBSSxFQUFFLENBQUNDLENBQUQsRUFBSUMsRUFBSixFQUFRQyxFQUFSLEVBQVlDLENBQVosS0FBbUJILENBQUMsQ0FBQ0csQ0FBRCxDQUFELEdBQU9ILENBQUMsQ0FBQ0MsRUFBRCxDQUFELEdBQVFELENBQUMsQ0FBQ0UsRUFBRCxDQUQvQjtBQUVWRSxFQUFBQSxJQUFJLEVBQUUsQ0FBQ0osQ0FBRCxFQUFJQyxFQUFKLEVBQVFDLEVBQVIsRUFBWUMsQ0FBWixLQUFtQkgsQ0FBQyxDQUFDRyxDQUFELENBQUQsR0FBT0gsQ0FBQyxDQUFDQyxFQUFELENBQUQsR0FBUUMsRUFGOUI7QUFHVkcsRUFBQUEsSUFBSSxFQUFFLENBQUNMLENBQUQsRUFBSUMsRUFBSixF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QVY7QUFDQStELEVBQUFBLFFBQVEsQ0FBQ04sT0FBVCxDQUFpQixDQUFDLENBQUNmLEVBQUQsRUFBSyxHQUFHQyxNQUFSLENBQUQsS0FBcUI3QyxHQUFHLENBQUN3RCxHQUFHLENBQUNaLEVBQUQsQ0FBSCxDQUFRLENBQVIsQ0FBRCxDQUFILENBQWdCMUMsQ0FBaEIsRUFBbUIsR0FBRzJDLE1BQXRCLENBQXRDO0FBQ0EsU0FBTzNDLENBQUMsQ0FBQyxDQUFELENBQVI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG9wcyA9IHtcbiAgYWRkcjogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSArIHJbaTJdKSxcbiAgYWRkaTogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSArIGkyKSxcbiAgbXVscjogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSAqIHJbaTJdKSxcbiAgbXVsaTogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSAqIGkyKSxcbiAgYmFucjogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSAmIHJbaTJdKSxcbiAgYmFuaTogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSAmIGkyKSxcbiAgYm9ycjogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSB8IHJbaTJdKSxcbiAgYm9yaTogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSB8IGkyKSxcbiAgc2V0cjogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSksXG4gIHNldGk6IChyLCBpMSwgaTIsIG8pID0+IChyW29dID0gaTEpLFxuICBndGlyOiAociwgaTEsIGkyLCBvKSA9PiAocltvXSA9IGkxID4gcltpMl0gPyAxIDogMCksXG4gIGd0cmk6IChyLCBpMSwgaTIsIG8pID0+IChyW29dID0gcltpMV0gPiBpMiA/IDEgOiAwKSxcbiAgZ3RycjogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSA+IHJbaTJdID8gMSA6IDApLFxuICBlcWlyOiAociwgaTEsIGkyLCBvKSA9PiAocltvXSA9IGkxID09PSByW2kyXSA/IDEgOiAwKSxcbiAgZXFyaTogKHIsIGkxLCBpMiwgbykgPT4gKHJbb10gPSByW2kxXSA9PT0gaTIgPyAxIDogMCksXG4gIGVxcnI6IChyLCBpMSwgaTIsIG8pID0+IChyW29dID0gcltpMV0gPT09IHJbaTJdID8gMSA6IDApLFxufTtcbmNvbnN0IG51bWJlcnMgPSBhcnIgPT4gYXJyLm1hcCh4ID0+IHBhcnNlSW50KHgpKTtcblxuZnVuY3Rpb24gcGFyc2VTYW1wbGVzKGlucHV0KSB7XG4gIGNvbnN0IHNhbXBsZXMgPSBpbnB1dC5zcGxpdCgnXFxuXFxuXFxuXFxuJylbMF0uc3BsaXQoJ1xcblxcbicpO1xuICByZXR1cm4gc2FtcGxlcy5tYXAoc2FtcGxlID0+IHtcbiAgICBjb25zdCBbYmVmb3JlLCBpbnN0cnVjdGlvbiwgYWZ0ZXJdID0gc2FtcGxlLnNwbGl0KCdcXG4nKTtcbiAgICBjb25zdCByZWdleCA9IC9cXFsoXFxkKyksIChcXGQrKSwgKFxcZCspLCAoXFxkKylcXF0vO1xuICAgIGNvbnN0IFssIHIxLCByMiwgcjMsIHI0XSA9IG51bWJlcnMoYmVmb3JlLm1hdGNoKHJlZ2V4KSk7XG4gICAgY29uc3QgWywgbzEsIG8yLCBvMywgbzRdID0gbnVtYmVycyhhZnRlci5tYXRjaChyZWdleCkpO1xuICAgIGNvbnN0IFtvcCwgLi4ucGFyYW1zXSA9IG51bWJlcnMoaW5zdHJ1Y3Rpb24uc3BsaXQoJyAnKSk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5rZXlzKG9wcykuZmlsdGVyKG9wID0+IHtcbiAgICAgIGNvbnN0IHIgPSBbcjEsIHIyLCByMywgcjRdO1xuICAgICAgY29uc3QgbyA9IFtvMSwgbzIsIG8zLCBvNF07XG4gICAgICBvcHNbb3BdKHIsIC4uLnBhcmFtcyk7XG4gICAgICByZXR1cm4gci5qb2luKCcsJykgPT09IG8uam9pbignLCcpO1xuICAgIH0pO1xuICAgIHJldHVybiB7IG9wLCBvcHRpb25zIH07XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFydDEoaW5wdXQpIHtcbiAgcmV0dXJuIHBhcnNlU2FtcGxlcyhpbnB1dCkuZmlsdGVyKHMgPT4gcy5vcHRpb25zLmxlbmd0aCA+PSAzKS5sZW5ndGg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJ0MihpbnB1dCkge1xuICBjb25zdCByZXN1bHQgPSBwYXJzZVNhbXBsZXMoaW5wdXQpO1xuICBsZXQgZGljID0gbmV3IEFycmF5KE9iamVjdC5rZXlzKG9wcykubGVuZ3RoKS5maWxsKCk7XG4gIGRpYyA9IGRpYy5tYXAoKCkgPT4gT2JqZWN0LmtleXMob3BzKSk7XG4gIHJlc3VsdC5mb3JFYWNoKCh7IG9wLCBvcHRpb25zIH0pID0+IHtcbiAgICBkaWNbb3BdID0gZGljW29wXS5maWx0ZXIoeCA9PiBvcHRpb25zLmluY2x1ZGVzKHgpKTtcbiAgfSk7XG4gIHdoaWxlIChkaWMuc29tZSh4ID0+IHgubGVuZ3RoID4gMSkpIHtcbiAgICBjb25zdCBkb25lID0gZGljLmZpbHRlcih4ID0+IHgubGVuZ3RoID09PSAxKS5tYXAoeCA9PiB4WzBdKTtcbiAgICBkaWMgPSBkaWMubWFwKHggPT4gKHgubGVuZ3RoID4gMSA/IHguZmlsdGVyKG9wID0+ICFkb25lLmluY2x1ZGVzKG9wKSkgOiB4KSk7XG4gIH1cblxuICBjb25zdCBwcm9ncmFtID0gaW5wdXQuc3BsaXQoJ1xcblxcblxcblxcbicpLnBvcCgpO1xuICBjb25zdCBjb21tYW5kcyA9IHByb2dyYW0uc3BsaXQoJ1xcbicpLm1hcCh4ID0+IG51bWJlcnMoeC5zcGxpdCgnICcpKSk7XG4gIGNvbnN0IHIgPSBbMCwgMCwgMCwgMF07XG4gIGNvbW1hbmRzLmZvckVhY2goKFtvcCwgLi4ucGFyYW1zXSkgPT4gb3BzW2RpY1tvcF1bMF1dKHIsIC4uLnBhcmFtcykpO1xuICByZXR1cm4gclswXTtcbn1cbiJdfQ==