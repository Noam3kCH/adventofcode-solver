686a08e48475ffb8c742db8b9dfff848
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getter = getter;
exports.parse = parse;
exports.part1 = part1;
exports.part2 = part2;

function getter(state, p) {
  if (typeof p === 'string') {
    if (state[p] === undefined) {
      state[p] = 0;
    }

    return state[p];
  } else {
    return p;
  }
}

function parse(input, ops2 = {}, debug) {
  const ops = {
    snd: p1 => state => state.sound = getter(state, p1),
    set: (p1, p2) => state => state[p1] = getter(state, p2),
    add: (p1, p2) => state => state[p1] = getter(state, p1) + getter(state, p2),
    mul: (p1, p2) => state => state[p1] = getter(state, p1) * getter(state, p2),
    mod: (p1, p2) => state => state[p1] = getter(state, p1) % getter(state, p2),
    rcv: p1 => state => getter(p1) !== 0 ? state.recovered = state.sound : null,
    jgz: (p1, p2) => state => getter(state, p1) > 0 ? state.instruction += getter(state, p2) - 1 : null,
    ...ops2
  };
  return input.split('\n').map(str => {
    const [cmd, p1Str, p2Str] = str.split(' ');
    const p1 = p1Str.match(/^-?\d+$/) ? parseInt(p1Str) : p1Str;
    const p2 = p2Str && p2Str.match(/^-?\d+$/) ? parseInt(p2Str) : p2Str;
    return state => (!debug || debug(cmd)) && ops[cmd](p1, p2)(state);
  });
}

function parse2(input) {
  return parse(input, {
    snd: p1 => state => {
      state.send.push(getter(state, p1));
      state.sent++;
    },
    rcv: p1 => state => {
      if (state.queue.length > 0) {
        state[p1] = state.queue.shift();
      } else {
        throw new Error('waiting...');
      }
    }
  });
}

function part1(input) {
  const commands = parse(input);
  const state = {
    instruction: 0
  };

  while (state.instruction < commands.length && !state.recovered) {
    commands[state.instruction](state);
    state.instruction++;
  }

  return state.recovered;
}

function execute(commands, state) {
  let run = 0;

  try {
    while (state.instruction < commands.length) {
      commands[state.instruction](state);
      state.instruction++;
      run++;
    }
  } catch (e) {//
  }

  return run;
}

function part2(input) {
  const commands = parse2(input);
  const state1 = {
    instruction: 0,
    queue: [],
    sent: 0,
    p: 0
  };
  const state2 = {
    instruction: 0,
    queue: [],
    sent: 0,
    p: 1
  };
  state1.send = state2.queue;
  state2.send = state1.queue;
  let running = true;

  while (running) {
    running = execute(commands, state1) > 0 || execute(commands, state2) > 0;
  }

  return state2.sent;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRheTE4LmpzIl0sIm5hbWVzIjpbImdldHRlciIsInN0YXRlIiwicCIsInVuZGVmaW5lZCIsInBhcnNlIiwiaW5wdXQiLCJvcHMyIiwiZGVidWciLCJvcHMiLCJzbmQiLCJwMSIsInNvdW5kIiwic2V0IiwicDIiLCJhZGQiLCJtdWwiLCJtb2QiLCJyY3YiLCJyZWNvdmVyZWQiLCJqZ3oiLCJpbnN0cnVjdGlvbiIsInNwbGl0IiwibWFwIiwic3RyIiwiY21kIiwicDFTdHIiLCJwMlN0ciIsIm1hdGNoIiwicGFyc2VJbnQiLCJwYXJzZTIiLCJzZW5kIiwicHVzaCIsInNlbnQiLCJxdWV1ZSIsImxlbmd0aCIsInNoaWZ0IiwiRXJyb3IiLCJwYXJ0MSIsImNvbW1hbmRzIiwiZXhlY3V0ZSIsInJ1biIsImUiLCJwYXJ0MiIsInN0YXRlMSIsInN0YXRlMiIsInJ1bm5pbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBTyxTQUFTQSxNQUFULENBQWdCQyxLQUFoQixFQUF1QkMsQ0FBdkIsRUFBMEI7QUFDL0IsTUFBSSxPQUFPQSxDQUFQLEtBQWEsUUFBakIsRUFBMkI7QUFDekIsUUFBSUQsS0FBSyxDQUFDQyxDQUFELENBQUwsS0FBYUMsU0FBakIsRUFBNEI7QUFDMUJGLE1BQUFBLEtBQUssQ0FBQ0MsQ0FBRCxDQUFMLEdBQVcsQ0FBWDtBQUNEOztBQUNELFdBQU9ELEtBQUssQ0FBQ0MsQ0FBRCxDQUFaO0FBQ0QsR0FMRCxNQUtPO0FBQ0wsV0FBT0EsQ0FBUDtBQUNEO0FBQ0Y7O0FBRU0sU0FBU0UsS0FBVCxDQUFlQyxLQUFmLEVBQXNCQyxJQUFJLEdBQUcsRUFBN0IsRUFBaUNDLEtBQWpDLEVBQXdDO0FBQzdDLFFBQU1DLEdBQUcsR0FBRztBQUNWQyxJQUFBQSxHQUFHLEVBQUVDLEVBQUUsSUFBSVQsS0FBSyxJQUFLQSxLQUFLLENBQUNVLEtBQU4sR0FBY1gsTUFBTSxDQUFDQyxLQUFELEVBQVFTLEVBQVIsQ0FEL0I7QUFFVkUsSUFBQUEsR0FBRyxFQUFFLENB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QUNBLFFBQU1zQyxNQUFNLEdBQUc7QUFBRXZCLElBQUFBLFdBQVcsRUFBRSxDQUFmO0FBQWtCYSxJQUFBQSxLQUFLLEVBQUUsRUFBekI7QUFBNkJELElBQUFBLElBQUksRUFBRSxDQUFuQztBQUFzQzlCLElBQUFBLENBQUMsRUFBRTtBQUF6QyxHQUFmO0FBQ0EsUUFBTTBDLE1BQU0sR0FBRztBQUFFeEIsSUFBQUEsV0FBVyxFQUFFLENBQWY7QUFBa0JhLElBQUFBLEtBQUssRUFBRSxFQUF6QjtBQUE2QkQsSUFBQUEsSUFBSSxFQUFFLENBQW5DO0FBQXNDOUIsSUFBQUEsQ0FBQyxFQUFFO0FBQXpDLEdBQWY7QUFDQXlDLEVBQUFBLE1BQU0sQ0FBQ2IsSUFBUCxHQUFjYyxNQUFNLENBQUNYLEtBQXJCO0FBQ0FXLEVBQUFBLE1BQU0sQ0FBQ2QsSUFBUCxHQUFjYSxNQUFNLENBQUNWLEtBQXJCO0FBRUEsTUFBSVksT0FBTyxHQUFHLElBQWQ7O0FBQ0EsU0FBT0EsT0FBUCxFQUFnQjtBQUNkQSxJQUFBQSxPQUFPLEdBQUdOLE9BQU8sQ0FBQ0QsUUFBRCxFQUFXSyxNQUFYLENBQVAsR0FBNEIsQ0FBNUIsSUFBaUNKLE9BQU8sQ0FBQ0QsUUFBRCxFQUFXTSxNQUFYLENBQVAsR0FBNEIsQ0FBdkU7QUFDRDs7QUFDRCxTQUFPQSxNQUFNLENBQUNaLElBQWQ7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBnZXR0ZXIoc3RhdGUsIHApIHtcbiAgaWYgKHR5cGVvZiBwID09PSAnc3RyaW5nJykge1xuICAgIGlmIChzdGF0ZVtwXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBzdGF0ZVtwXSA9IDA7XG4gICAgfVxuICAgIHJldHVybiBzdGF0ZVtwXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2UoaW5wdXQsIG9wczIgPSB7fSwgZGVidWcpIHtcbiAgY29uc3Qgb3BzID0ge1xuICAgIHNuZDogcDEgPT4gc3RhdGUgPT4gKHN0YXRlLnNvdW5kID0gZ2V0dGVyKHN0YXRlLCBwMSkpLFxuICAgIHNldDogKHAxLCBwMikgPT4gc3RhdGUgPT4gKHN0YXRlW3AxXSA9IGdldHRlcihzdGF0ZSwgcDIpKSxcbiAgICBhZGQ6IChwMSwgcDIpID0+IHN0YXRlID0+XG4gICAgICAoc3RhdGVbcDFdID0gZ2V0dGVyKHN0YXRlLCBwMSkgKyBnZXR0ZXIoc3RhdGUsIHAyKSksXG4gICAgbXVsOiAocDEsIHAyKSA9PiBzdGF0ZSA9PlxuICAgICAgKHN0YXRlW3AxXSA9IGdldHRlcihzdGF0ZSwgcDEpICogZ2V0dGVyKHN0YXRlLCBwMikpLFxuICAgIG1vZDogKHAxLCBwMikgPT4gc3RhdGUgPT5cbiAgICAgIChzdGF0ZVtwMV0gPSBnZXR0ZXIoc3RhdGUsIHAxKSAlIGdldHRlcihzdGF0ZSwgcDIpKSxcbiAgICByY3Y6IHAxID0+IHN0YXRlID0+XG4gICAgICBnZXR0ZXIocDEpICE9PSAwID8gKHN0YXRlLnJlY292ZXJlZCA9IHN0YXRlLnNvdW5kKSA6IG51bGwsXG4gICAgamd6OiAocDEsIHAyKSA9PiBzdGF0ZSA9PlxuICAgICAgZ2V0dGVyKHN0YXRlLCBwMSkgPiAwXG4gICAgICAgID8gKHN0YXRlLmluc3RydWN0aW9uICs9IGdldHRlcihzdGF0ZSwgcDIpIC0gMSlcbiAgICAgICAgOiBudWxsLFxuICAgIC4uLm9wczIsXG4gIH07XG5cbiAgcmV0dXJuIGlucHV0LnNwbGl0KCdcXG4nKS5tYXAoc3RyID0+IHtcbiAgICBjb25zdCBbY21kLCBwMVN0ciwgcDJTdHJdID0gc3RyLnNwbGl0KCcgJyk7XG4gICAgY29uc3QgcDEgPSBwMVN0ci5tYXRjaCgvXi0/XFxkKyQvKSA/IHBhcnNlSW50KHAxU3RyKSA6IHAxU3RyO1xuICAgIGNvbnN0IHAyID0gcDJTdHIgJiYgcDJTdHIubWF0Y2goL14tP1xcZCskLykgPyBwYXJzZUludChwMlN0cikgOiBwMlN0cjtcbiAgICByZXR1cm4gc3RhdGUgPT4gKCFkZWJ1ZyB8fCBkZWJ1ZyhjbWQpKSAmJiBvcHNbY21kXShwMSwgcDIpKHN0YXRlKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHBhcnNlMihpbnB1dCkge1xuICByZXR1cm4gcGFyc2UoaW5wdXQsIHtcbiAgICBzbmQ6IHAxID0+IHN0YXRlID0+IHtcbiAgICAgIHN0YXRlLnNlbmQucHVzaChnZXR0ZXIoc3RhdGUsIHAxKSk7XG4gICAgICBzdGF0ZS5zZW50Kys7XG4gICAgfSxcbiAgICByY3Y6IHAxID0+IHN0YXRlID0+IHtcbiAgICAgIGlmIChzdGF0ZS5xdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHN0YXRlW3AxXSA9IHN0YXRlLnF1ZXVlLnNoaWZ0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3dhaXRpbmcuLi4nKTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnQxKGlucHV0KSB7XG4gIGNvbnN0IGNvbW1hbmRzID0gcGFyc2UoaW5wdXQpO1xuICBjb25zdCBzdGF0ZSA9IHsgaW5zdHJ1Y3Rpb246IDAgfTtcbiAgd2hpbGUgKHN0YXRlLmluc3RydWN0aW9uIDwgY29tbWFuZHMubGVuZ3RoICYmICFzdGF0ZS5yZWNvdmVyZWQpIHtcbiAgICBjb21tYW5kc1tzdGF0ZS5pbnN0cnVjdGlvbl0oc3RhdGUpO1xuICAgIHN0YXRlLmluc3RydWN0aW9uKys7XG4gIH1cbiAgcmV0dXJuIHN0YXRlLnJlY292ZXJlZDtcbn1cblxuZnVuY3Rpb24gZXhlY3V0ZShjb21tYW5kcywgc3RhdGUpIHtcbiAgbGV0IHJ1biA9IDA7XG4gIHRyeSB7XG4gICAgd2hpbGUgKHN0YXRlLmluc3RydWN0aW9uIDwgY29tbWFuZHMubGVuZ3RoKSB7XG4gICAgICBjb21tYW5kc1tzdGF0ZS5pbnN0cnVjdGlvbl0oc3RhdGUpO1xuICAgICAgc3RhdGUuaW5zdHJ1Y3Rpb24rKztcbiAgICAgIHJ1bisrO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vXG4gIH1cbiAgcmV0dXJuIHJ1bjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnQyKGlucHV0KSB7XG4gIGNvbnN0IGNvbW1hbmRzID0gcGFyc2UyKGlucHV0KTtcbiAgY29uc3Qgc3RhdGUxID0geyBpbnN0cnVjdGlvbjogMCwgcXVldWU6IFtdLCBzZW50OiAwLCBwOiAwIH07XG4gIGNvbnN0IHN0YXRlMiA9IHsgaW5zdHJ1Y3Rpb246IDAsIHF1ZXVlOiBbXSwgc2VudDogMCwgcDogMSB9O1xuICBzdGF0ZTEuc2VuZCA9IHN0YXRlMi5xdWV1ZTtcbiAgc3RhdGUyLnNlbmQgPSBzdGF0ZTEucXVldWU7XG5cbiAgbGV0IHJ1bm5pbmcgPSB0cnVlO1xuICB3aGlsZSAocnVubmluZykge1xuICAgIHJ1bm5pbmcgPSBleGVjdXRlKGNvbW1hbmRzLCBzdGF0ZTEpID4gMCB8fCBleGVjdXRlKGNvbW1hbmRzLCBzdGF0ZTIpID4gMDtcbiAgfVxuICByZXR1cm4gc3RhdGUyLnNlbnQ7XG59XG4iXX0=